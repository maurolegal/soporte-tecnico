<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechSupport Pro | Módulo de Cotizaciones</title>
    
    <!-- Bootstrap 5 + Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar p-0">
                <div class="p-4">
                    <h4 class="text-white mb-4">
                        <i class="fas fa-tools me-2"></i>TechSupport Pro
                    </h4>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html" id="nav-dashboard">
                                <i class="fas fa-chart-line"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="soporte.html" id="nav-soporte">
                                <i class="fas fa-laptop-medical"></i> Soporte
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="cotizaciones.html" id="nav-cotizaciones">
                                <i class="fas fa-file-invoice-dollar"></i> Cotizaciones
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="facturas.html" id="nav-facturas">
                                <i class="fas fa-receipt"></i> Facturas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="inventario.html" id="nav-inventario">
                                <i class="fas fa-boxes"></i> Inventario
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="directorio.html" id="nav-directorio">
                                <i class="fas fa-address-book"></i> Directorio
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="ajustes.html" id="nav-ajustes">
                                <i class="fas fa-cog"></i> Ajustes
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-10 ms-auto p-4">
                <div class="row mb-4">
                    <div class="col-12">
                        <h4 class="fade-in"><i class="fas fa-file-invoice-dollar me-2"></i>Gestión de Cotizaciones</h4>
                    </div>
                </div>

                <!-- Resumen de Cotizaciones -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card card-support fade-in">
                            <div class="card-body">
                                <h6 class="text-muted">Cotizaciones Totales</h6>
                                <h3>24</h3>
                                <div class="progress progress-custom">
                                    <div class="progress-bar progress-bar-custom bg-primary" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card card-support fade-in">
                            <div class="card-body">
                                <h6 class="text-muted">Pendientes</h6>
                                <h3>8</h3>
                                <div class="progress progress-custom">
                                    <div class="progress-bar progress-bar-custom bg-warning" style="width: 33%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card card-support fade-in">
                            <div class="card-body">
                                <h6 class="text-muted">Aprobadas</h6>
                                <h3>12</h3>
                                <div class="progress progress-custom">
                                    <div class="progress-bar progress-bar-custom bg-success" style="width: 50%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card card-support fade-in">
                            <div class="card-body">
                                <h6 class="text-muted">Rechazadas</h6>
                                <h3>4</h3>
                                <div class="progress progress-custom">
                                    <div class="progress-bar progress-bar-custom bg-danger" style="width: 17%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Cotizaciones -->
                <div class="card card-support fade-in mb-4">
                    <div class="card-header bg-white">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Lista de Cotizaciones</h5>
                            <div class="d-flex gap-2">
                                <button class="btn btn-success btn-sm btn-custom" onclick="exportToExcel()">
                                    <i class="fas fa-file-excel me-1"></i>Exportar a Excel
                                </button>
                                <button class="btn btn-primary btn-sm btn-custom" onclick="printQuotes()">
                                    <i class="fas fa-print me-1"></i>Imprimir
                                </button>
                            </div>
                        </div>
                        <div class="search-container">
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0">
                                    <i class="fas fa-search text-muted"></i>
                                </span>
                                <input type="text" 
                                       class="form-control form-control-custom border-start-0" 
                                       id="searchQuote" 
                                       placeholder="Buscar por cliente, ID o estado..."
                                       onkeyup="searchTable()">
                            </div>
                            <div class="mt-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="searchClient" checked>
                                    <label class="form-check-label" for="searchClient">Cliente</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="searchId" checked>
                                    <label class="form-check-label" for="searchId">ID</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="searchStatus" checked>
                                    <label class="form-check-label" for="searchStatus">Estado</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-custom" id="quotesTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cliente</th>
                                        <th>Equipo</th>
                                        <th>Fecha</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>#COT001</td>
                                        <td>Ana Martínez</td>
                                        <td>HP Pavilion 15-dk1056wm</td>
                                        <td>20/03/2024</td>
                                        <td>$180.00</td>
                                        <td><span class="status-badge status-pendiente">Pendiente</span></td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-info btn-custom" onclick="viewQuote('COT001')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-success btn-custom" onclick="approveQuote('COT001')">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-danger btn-custom" onclick="rejectQuote('COT001')">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                                <button class="btn btn-primary btn-custom" onclick="printQuote('COT001')">
                                                    <i class="fas fa-print"></i>
                                                </button>
                                                <button class="btn btn-warning btn-custom" onclick="convertToInvoice('COT001')">
                                                    <i class="fas fa-file-invoice"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <!-- Más filas de ejemplo -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver Cotización -->
    <div class="modal fade" id="viewQuoteModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-white">
                    <h5 class="mb-0">
                        <i class="fas fa-file-invoice me-2"></i>Cotización #<span id="viewQuoteId"></span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <!-- Información del Cliente -->
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Información del Cliente</h6>
                                </div>
                                <div class="card-body">
                                    <dl class="row mb-0">
                                        <dt class="col-sm-4">Nombre:</dt>
                                        <dd class="col-sm-8" id="viewClientName"></dd>
                                        <dt class="col-sm-4">Teléfono:</dt>
                                        <dd class="col-sm-8" id="viewClientPhone"></dd>
                                        <dt class="col-sm-4">Correo:</dt>
                                        <dd class="col-sm-8" id="viewClientEmail"></dd>
                                        <dt class="col-sm-4">Dirección:</dt>
                                        <dd class="col-sm-8" id="viewClientAddress"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div>

                        <!-- Información del Equipo -->
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Información del Equipo</h6>
                                </div>
                                <div class="card-body">
                                    <dl class="row mb-0">
                                        <dt class="col-sm-4">Marca:</dt>
                                        <dd class="col-sm-8" id="viewEquipmentBrand"></dd>
                                        <dt class="col-sm-4">Modelo:</dt>
                                        <dd class="col-sm-8" id="viewEquipmentModel"></dd>
                                        <dt class="col-sm-4">Serie:</dt>
                                        <dd class="col-sm-8" id="viewEquipmentSerial"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div>

                        <!-- Detalles de la Cotización -->
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Detalles de la Cotización</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table" id="viewQuoteItemsTable">
                                            <thead>
                                                <tr>
                                                    <th>Descripción</th>
                                                    <th>Cantidad</th>
                                                    <th>Precio Unit.</th>
                                                    <th>Subtotal</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Los items se cargarán dinámicamente -->
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td colspan="3" class="text-end">Subtotal:</td>
                                                    <td id="viewQuoteSubtotal"></td>
                                                </tr>
                                                <tr>
                                                    <td colspan="3" class="text-end">IVA (16%):</td>
                                                    <td id="viewQuoteTax"></td>
                                                </tr>
                                                <tr>
                                                    <td colspan="3" class="text-end fw-bold">Total:</td>
                                                    <td id="viewQuoteTotal" class="fw-bold"></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                    <div class="mt-3">
                                        <h6>Notas Adicionales:</h6>
                                        <p id="viewQuoteNotes" class="mb-0"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary btn-custom" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-success btn-custom" onclick="approveQuote()">
                        <i class="fas fa-check me-2"></i>Aprobar
                    </button>
                    <button type="button" class="btn btn-danger btn-custom" onclick="rejectQuote()">
                        <i class="fas fa-times me-2"></i>Rechazar
                    </button>
                    <button type="button" class="btn btn-primary btn-custom" onclick="printQuote()">
                        <i class="fas fa-print me-2"></i>Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script>
        // Función para buscar en la tabla
        function searchTable() {
            const searchInput = document.getElementById('searchQuote').value.toLowerCase();
            const table = document.getElementById('quotesTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            const searchClient = document.getElementById('searchClient').checked;
            const searchId = document.getElementById('searchId').checked;
            const searchStatus = document.getElementById('searchStatus').checked;

            for (let row of rows) {
                let found = false;

                // ID
                if (searchId) {
                    const id = row.cells[0].textContent.toLowerCase();
                    if (id.includes(searchInput)) {
                        found = true;
                        row.cells[0].innerHTML = highlightText(id, searchInput);
                    } else {
                        row.cells[0].innerHTML = id;
                    }
                }

                // Cliente
                if (searchClient) {
                    const client = row.cells[1].textContent.toLowerCase();
                    if (client.includes(searchInput)) {
                        found = true;
                        row.cells[1].innerHTML = highlightText(row.cells[1].textContent, searchInput);
                    } else {
                        row.cells[1].innerHTML = row.cells[1].textContent;
                    }
                }

                // Estado
                if (searchStatus) {
                    const status = row.cells[5].textContent.toLowerCase();
                    if (status.includes(searchInput)) {
                        found = true;
                        row.cells[5].innerHTML = highlightText(row.cells[5].textContent, searchInput);
                    } else {
                        row.cells[5].innerHTML = row.cells[5].textContent;
                    }
                }

                row.style.display = found || searchInput === '' ? '' : 'none';
            }
        }

        function highlightText(text, search) {
            if (search === '') return text;
            const regex = new RegExp(`(${search})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // Función para ver una cotización
        function viewQuote(quoteId) {
            // Aquí iría la lógica para cargar los datos de la cotización
            document.getElementById('viewQuoteId').textContent = quoteId;
            
            // Datos de ejemplo
            document.getElementById('viewClientName').textContent = 'Ana Martínez';
            document.getElementById('viewClientPhone').textContent = '+1234567890';
            document.getElementById('viewClientEmail').textContent = 'ana@email.com';
            document.getElementById('viewClientAddress').textContent = 'Av. Principal #123, Ciudad';
            
            document.getElementById('viewEquipmentBrand').textContent = 'HP';
            document.getElementById('viewEquipmentModel').textContent = 'Pavilion 15-dk1056wm';
            document.getElementById('viewEquipmentSerial').textContent = '5CD9876543';

            // Cargar items de ejemplo
            const tbody = document.querySelector('#viewQuoteItemsTable tbody');
            tbody.innerHTML = `
                <tr>
                    <td>Diagnóstico y reparación de sistema de ventilación</td>
                    <td>1</td>
                    <td>$180.00</td>
                    <td>$180.00</td>
                </tr>
            `;

            // Actualizar totales
            document.getElementById('viewQuoteSubtotal').textContent = '$180.00';
            document.getElementById('viewQuoteTax').textContent = '$28.80';
            document.getElementById('viewQuoteTotal').textContent = '$208.80';

            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('viewQuoteModal'));
            modal.show();
        }

        // Función para aprobar una cotización
        function approveQuote(quoteId) {
            if (confirm(`¿Estás seguro de aprobar la cotización #${quoteId}?`)) {
                // Aquí iría la lógica para aprobar la cotización
                alert(`Cotización #${quoteId} aprobada correctamente`);
            }
        }

        // Función para rechazar una cotización
        function rejectQuote(quoteId) {
            if (confirm(`¿Estás seguro de rechazar la cotización #${quoteId}?`)) {
                // Aquí iría la lógica para rechazar la cotización
                alert(`Cotización #${quoteId} rechazada`);
            }
        }

        // Función para imprimir una cotización
        function printQuote(quoteId) {
            // Aquí iría la lógica para imprimir la cotización
            window.print();
        }

        // Función para exportar a Excel
        function exportToExcel() {
            // Aquí iría la lógica para exportar a Excel
            alert('Exportando a Excel...');
        }

        // Función para imprimir todas las cotizaciones
        function printQuotes() {
            // Aquí iría la lógica para imprimir todas las cotizaciones
            window.print();
        }

        // Función para convertir cotización a factura
        function convertToInvoice(quoteId) {
            if (confirm(`¿Estás seguro de convertir la cotización #${quoteId} en factura?`)) {
                // Aquí iría la lógica para convertir la cotización en factura
                // Por ejemplo, redirigir a la página de facturas con los datos de la cotización
                window.location.href = `facturas.html?fromQuote=${quoteId}`;
            }
        }
    </script> 
    // Agregar este script en todos los archivos HTML
    <script>
    // Función para manejar la navegación activa
    function setActiveNavItem() {
        // Obtener el nombre del archivo actual
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';
        
        // Remover la clase active de todos los enlaces
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        // Agregar la clase active al enlace correspondiente
        let navId = '';
        switch(currentPage) {
            case 'index.html':
                navId = 'nav-dashboard';
                break;
            case 'soporte.html':
                navId = 'nav-soporte';
                break;
            case 'cotizaciones.html':
                navId = 'nav-cotizaciones';
                break;
            case 'facturas.html':
                navId = 'nav-facturas';
                break;
            case 'inventario.html':
                navId = 'nav-inventario';
                break;
            case 'directorio.html':
                navId = 'nav-directorio';
                break;
            case 'ajustes.html':
                navId = 'nav-ajustes';
                break;
        }
        
        const activeLink = document.getElementById(navId);
        if (activeLink) {
            activeLink.classList.add('active');
        }
    }
    
    // Agregar estos estilos para el menú
    document.head.insertAdjacentHTML('beforeend', `
        <style>
            .sidebar {
                background-color: #2c3e50;
                min-height: 100vh;
                position: fixed;
                top: 0;
                left: 0;
                z-index: 100;
            }
            
            .nav-link {
                color: rgba(255,255,255,0.7);
                padding: 0.8rem 1rem;
                margin-bottom: 0.2rem;
                border-radius: 0.3rem;
                transition: all 0.3s ease;
            }
            
            .nav-link:hover {
                color: white;
                background-color: rgba(255,255,255,0.1);
                transform: translateX(5px);
            }
            
            .nav-link.active {
                color: white;
                background-color: rgba(255,255,255,0.2);
            }
            
            .nav-link i {
                width: 20px;
                margin-right: 10px;
                text-align: center;
            }
            
            /* Ajuste para el contenido principal */
            .main-content {
                margin-left: 16.666667%; /* col-md-2 */
            }
        </style>
    `);
    
    // Ejecutar cuando el DOM esté cargado
    document.addEventListener('DOMContentLoaded', setActiveNavItem);
    
    // Manejar el estado del tema oscuro
    function loadThemePreference() {
        const darkMode = localStorage.getItem('darkMode') === 'true';
        document.body.classList.toggle('dark-mode', darkMode);
    }
    
    // Cargar preferencia de tema al inicio
    loadThemePreference();
    </script>

    <style>
    .search-container {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
    }

    .form-check-input:checked {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }

    .highlight {
        background-color: #fff3cd;
        padding: 2px;
        border-radius: 3px;
    }

    .status-badge {
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.85em;
        font-weight: 500;
    }

    .status-pendiente {
        background-color: #fff3cd;
        color: #856404;
    }

    .status-aprobada {
        background-color: #d4edda;
        color: #155724;
    }

    .status-rechazada {
        background-color: #f8d7da;
        color: #721c24;
    }

    @media print {
        .sidebar, .btn-group, .search-container {
            display: none !important;
        }
        
        .card {
            border: none !important;
        }
        
        .card-header {
            background-color: white !important;
        }
    }
    </style>
</body>
</html> 