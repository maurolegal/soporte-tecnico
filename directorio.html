<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechSupport Pro | Directorio de Clientes</title>
    
    <!-- Bootstrap 5 + Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <style>
    .list-group-item {
        transition: all 0.3s ease;
    }

    .list-group-item:hover {
        transform: translateX(5px);
    }

    .list-group-item.border-danger {
        border-width: 2px;
    }

    .badge {
        font-size: 0.8em;
        padding: 0.4em 0.6em;
    }

    .btn-group .btn-custom {
        position: relative;
    }

    .btn-group .btn-custom:hover::after {
        content: attr(data-title);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 5px;
        background: rgba(0,0,0,0.8);
        color: white;
        border-radius: 4px;
        font-size: 12px;
        white-space: nowrap;
    }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar p-0">
                <div class="p-4">
                    <h4 class="text-white mb-4">
                        <i class="fas fa-tools me-2"></i>TechSupport Pro
                    </h4>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html" id="nav-dashboard">
                                <i class="fas fa-chart-line"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="soporte.html" id="nav-soporte">
                                <i class="fas fa-laptop-medical"></i> Soporte
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="cotizaciones.html" id="nav-cotizaciones">
                                <i class="fas fa-file-invoice-dollar"></i> Cotizaciones
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="facturas.html" id="nav-facturas">
                                <i class="fas fa-receipt"></i> Facturas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="inventario.html" id="nav-inventario">
                                <i class="fas fa-boxes"></i> Inventario
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="directorio.html" id="nav-directorio">
                                <i class="fas fa-address-book"></i> Directorio
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="ajustes.html" id="nav-ajustes">
                                <i class="fas fa-cog"></i> Ajustes
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-10 ms-auto p-4">
                <div class="row mb-4">
                    <div class="col-12">
                        <h4 class="fade-in"><i class="fas fa-address-book me-2"></i>Directorio de Clientes</h4>
                    </div>
                </div>

                <!-- Resumen de Clientes -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card card-support fade-in">
                            <div class="card-body">
                                <h6 class="text-muted">Clientes Totales</h6>
                                <h3>128</h3>
                                <div class="progress progress-custom">
                                    <div class="progress-bar progress-bar-custom bg-primary" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card card-support fade-in">
                            <div class="card-body">
                                <h6 class="text-muted">Clientes Activos</h6>
                                <h3>98</h3>
                                <div class="progress progress-custom">
                                    <div class="progress-bar progress-bar-custom bg-success" style="width: 76%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card card-support fade-in">
                            <div class="card-body">
                                <h6 class="text-muted">Clientes Recientes</h6>
                                <h3>12</h3>
                                <div class="progress progress-custom">
                                    <div class="progress-bar progress-bar-custom bg-info" style="width: 9%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card card-support fade-in">
                            <div class="card-body">
                                <h6 class="text-muted">Clientes Inactivos</h6>
                                <h3>30</h3>
                                <div class="progress progress-custom">
                                    <div class="progress-bar progress-bar-custom bg-warning" style="width: 24%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alertas de Soporte -->
                <div class="col-md-6 mb-4">
                    <div class="card card-support fade-in">
                        <div class="card-header bg-white">
                            <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Alertas de Soporte</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <button class="btn btn-primary btn-sm" onclick="createSupportAlert()">
                                    <i class="fas fa-plus me-1"></i>Nueva Alerta
                                </button>
                            </div>
                            <div id="supportAlertsList" class="list-group">
                                <!-- Las alertas se cargarán dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Clientes -->
                <div class="card card-support fade-in mb-4">
                    <div class="card-header bg-white">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Lista de Clientes</h5>
                            <div class="d-flex gap-2">
                                <button class="btn btn-success btn-sm btn-custom" onclick="exportToExcel()">
                                    <i class="fas fa-file-excel me-1"></i>Exportar
                                </button>
                                <button class="btn btn-primary btn-sm btn-custom" onclick="addNewClient()">
                                    <i class="fas fa-plus me-1"></i>Nuevo Cliente
                                </button>
                            </div>
                        </div>
                        <div class="search-container">
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0">
                                    <i class="fas fa-search text-muted"></i>
                                </span>
                                <input type="text" 
                                       class="form-control form-control-custom border-start-0" 
                                       id="searchClient" 
                                       placeholder="Buscar por nombre, teléfono o correo..."
                                       onkeyup="searchClients()">
                            </div>
                            <div class="mt-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="searchName" checked>
                                    <label class="form-check-label" for="searchName">Nombre</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="searchPhone" checked>
                                    <label class="form-check-label" for="searchPhone">Teléfono</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="searchEmail" checked>
                                    <label class="form-check-label" for="searchEmail">Correo</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-custom" id="clientsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Teléfono</th>
                                        <th>Correo</th>
                                        <th>Dirección</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>#CL001</td>
                                        <td>Ana Martínez</td>
                                        <td>+1234567890</td>
                                        <td>ana@email.com</td>
                                        <td>Av. Principal #123</td>
                                        <td><span class="status-badge status-activo">Activo</span></td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-info btn-custom" onclick="viewClient('CL001')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-warning btn-custom" onclick="editClient('CL001')">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-danger btn-custom" onclick="deleteClient('CL001')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                                <button class="btn btn-primary btn-custom" onclick="createClientReminder('CL001', 'Ana Martínez')">
                                                    <i class="fas fa-bell"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <!-- Más filas de ejemplo -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver/Editar Cliente -->
    <div class="modal fade" id="clientModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
            </div>
        </div>
    </div>

    <!-- Modal Crear Alerta de Soporte -->
    <div class="modal fade" id="createAlertModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Crear Alerta de Soporte</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Cliente</label>
                        <input type="text" class="form-control" id="alertClient">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Equipo</label>
                        <input type="text" class="form-control" id="alertEquipment">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Fecha Programada</label>
                        <input type="date" class="form-control" id="alertDate">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tipo de Soporte</label>
                        <select class="form-select" id="alertType">
                            <option value="mantenimiento">Mantenimiento Preventivo</option>
                            <option value="revision">Revisión General</option>
                            <option value="actualizacion">Actualización de Software</option>
                            <option value="garantia">Revisión de Garantía</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="alertDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Prioridad</label>
                        <select class="form-select" id="alertPriority">
                            <option value="baja">Baja</option>
                            <option value="media">Media</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveAlert()">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Recordatorio de Cliente -->
    <div class="modal fade" id="clientReminderModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Programar Recordatorio de Soporte</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Cliente</label>
                        <input type="text" class="form-control" id="reminderClientName" readonly>
                        <input type="hidden" id="reminderClientId">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Fecha de Servicio</label>
                        <input type="date" class="form-control" id="reminderDate" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tipo de Servicio</label>
                        <select class="form-select" id="reminderServiceType">
                            <option value="mantenimiento_preventivo">Mantenimiento Preventivo</option>
                            <option value="mantenimiento_correctivo">Mantenimiento Correctivo</option>
                            <option value="actualizacion">Actualización de Software</option>
                            <option value="revision">Revisión General</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Prioridad</label>
                        <select class="form-select" id="reminderPriority">
                            <option value="baja">Baja</option>
                            <option value="media">Media</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Notificar con Anticipación</label>
                        <select class="form-select" id="reminderNotification">
                            <option value="1">1 día antes</option>
                            <option value="3">3 días antes</option>
                            <option value="7">1 semana antes</option>
                            <option value="15">15 días antes</option>
                            <option value="30">1 mes antes</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Notas Adicionales</label>
                        <textarea class="form-control" id="reminderNotes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveClientReminder()">Guardar Recordatorio</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    
    <!-- Custom JS -->
    <script type="module">
        import { clientsApi } from './js/supabase.js';
        
        // Variables globales
        let clients = [];

        // Cargar clientes al iniciar
        async function loadClients() {
            try {
                const { data, error } = await clientsApi.getAll();
                if (error) throw error;
                
                clients = data;
                const tbody = document.querySelector('#clientsTable tbody');
                tbody.innerHTML = '';
                
                clients.forEach(client => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>#${client.id.slice(0, 8)}</td>
                        <td>${client.name}</td>
                        <td>${client.phone}</td>
                        <td>${client.email || '-'}</td>
                        <td>${client.address || '-'}</td>
                        <td><span class="status-badge status-activo">Activo</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-info btn-custom" onclick="window.viewClient('${client.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-warning btn-custom" onclick="window.editClient('${client.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-custom" onclick="window.deleteClient('${client.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="btn btn-primary btn-custom" onclick="window.createClientReminder('${client.id}', '${client.name}')">
                                    <i class="fas fa-bell"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                // Actualizar contadores
                updateClientCounters();
            } catch (error) {
                console.error('Error al cargar clientes:', error);
                showNotification('Error al cargar los clientes: ' + error.message, 'error');
            }
        }

        // Actualizar contadores de clientes
        function updateClientCounters() {
            const totalClients = clients.length;
            const activeClients = clients.filter(c => c.status !== 'inactive').length;
            const recentClients = clients.filter(c => {
                const createdAt = new Date(c.created_at);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return createdAt >= thirtyDaysAgo;
            }).length;
            const inactiveClients = clients.filter(c => c.status === 'inactive').length;

            document.querySelector('.card:nth-child(1) h3').textContent = totalClients;
            document.querySelector('.card:nth-child(2) h3').textContent = activeClients;
            document.querySelector('.card:nth-child(3) h3').textContent = recentClients;
            document.querySelector('.card:nth-child(4) h3').textContent = inactiveClients;
        }

        // Agregar nuevo cliente
        window.addNewClient = function() {
            const modal = document.getElementById('clientModal');
            modal.querySelector('.modal-content').innerHTML = `
                <div class="modal-header">
                    <h5 class="modal-title">Nuevo Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="clientForm">
                        <div class="mb-3">
                            <label class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="clientName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="clientPhone" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Correo</label>
                            <input type="email" class="form-control" id="clientEmail">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Dirección</label>
                            <input type="text" class="form-control" id="clientAddress">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="window.saveNewClient()">Guardar</button>
                </div>
            `;
            
            const modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        };

        // Guardar nuevo cliente
        window.saveNewClient = async function() {
            const form = document.getElementById('clientForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const newClient = {
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value || null,
                address: document.getElementById('clientAddress').value || null
            };

            try {
                const { data, error } = await clientsApi.create(newClient);
                if (error) throw error;

                await loadClients();
                const modal = bootstrap.Modal.getInstance(document.getElementById('clientModal'));
                modal.hide();
                showNotification('Cliente agregado exitosamente', 'success');
            } catch (error) {
                console.error('Error al crear cliente:', error);
                showNotification('Error al crear el cliente: ' + error.message, 'error');
            }
        };

        // Ver cliente
        window.viewClient = async function(clientId) {
            try {
                const { data: client, error } = await clientsApi.getById(clientId);
                if (error) throw error;
                if (!client) {
                    showNotification('Cliente no encontrado', 'error');
                    return;
                }

                const modal = document.getElementById('clientModal');
                modal.querySelector('.modal-content').innerHTML = `
                    <div class="modal-header">
                        <h5 class="modal-title">Detalles del Cliente</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-4"><strong>ID:</strong></div>
                            <div class="col-8">#${client.id.slice(0, 8)}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong>Nombre:</strong></div>
                            <div class="col-8">${client.name}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong>Teléfono:</strong></div>
                            <div class="col-8">${client.phone}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong>Correo:</strong></div>
                            <div class="col-8">${client.email || '-'}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong>Dirección:</strong></div>
                            <div class="col-8">${client.address || '-'}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4"><strong>Fecha de Registro:</strong></div>
                            <div class="col-8">${new Date(client.created_at).toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                `;
                
                const modalInstance = new bootstrap.Modal(modal);
                modalInstance.show();
            } catch (error) {
                console.error('Error al cargar cliente:', error);
                showNotification('Error al cargar los detalles del cliente: ' + error.message, 'error');
            }
        };

        // Editar cliente
        window.editClient = async function(clientId) {
            try {
                const { data: client, error } = await clientsApi.getById(clientId);
                if (error) throw error;
                if (!client) {
                    showNotification('Cliente no encontrado', 'error');
                    return;
                }

                const modal = document.getElementById('clientModal');
                modal.querySelector('.modal-content').innerHTML = `
                    <div class="modal-header">
                        <h5 class="modal-title">Editar Cliente</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="clientForm">
                            <input type="hidden" id="clientId" value="${client.id}">
                            <div class="mb-3">
                                <label class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="clientName" value="${client.name}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Teléfono</label>
                                <input type="tel" class="form-control" id="clientPhone" value="${client.phone}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Correo</label>
                                <input type="email" class="form-control" id="clientEmail" value="${client.email || ''}">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Dirección</label>
                                <input type="text" class="form-control" id="clientAddress" value="${client.address || ''}">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" onclick="window.saveEditedClient()">Guardar Cambios</button>
                    </div>
                `;
                
                const modalInstance = new bootstrap.Modal(modal);
                modalInstance.show();
            } catch (error) {
                console.error('Error al cargar cliente:', error);
                showNotification('Error al cargar los detalles del cliente: ' + error.message, 'error');
            }
        };

        // Guardar cliente editado
        window.saveEditedClient = async function() {
            const form = document.getElementById('clientForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const clientId = document.getElementById('clientId').value;
            const updatedClient = {
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value || null,
                address: document.getElementById('clientAddress').value || null
            };

            try {
                const { error } = await clientsApi.update(clientId, updatedClient);
                if (error) throw error;

                await loadClients();
                const modal = bootstrap.Modal.getInstance(document.getElementById('clientModal'));
                modal.hide();
                showNotification('Cliente actualizado exitosamente', 'success');
            } catch (error) {
                console.error('Error al actualizar cliente:', error);
                showNotification('Error al actualizar el cliente: ' + error.message, 'error');
            }
        };

        // Eliminar cliente
        window.deleteClient = async function(clientId) {
            if (!confirm('¿Está seguro de que desea eliminar este cliente?')) {
                return;
            }

            try {
                const { error } = await clientsApi.delete(clientId);
                if (error) throw error;

                await loadClients();
                showNotification('Cliente eliminado exitosamente', 'success');
            } catch (error) {
                console.error('Error al eliminar cliente:', error);
                showNotification('Error al eliminar el cliente: ' + error.message, 'error');
            }
        };

        // Búsqueda de clientes
        window.searchClients = async function() {
            const searchTerm = document.getElementById('searchClient').value.toLowerCase();
            const searchName = document.getElementById('searchName').checked;
            const searchPhone = document.getElementById('searchPhone').checked;
            const searchEmail = document.getElementById('searchEmail').checked;

            try {
                const { data: filteredClients, error } = await clientsApi.search({
                    term: searchTerm,
                    filters: {
                        name: searchName,
                        phone: searchPhone,
                        email: searchEmail
                    }
                });

                if (error) throw error;

                const tbody = document.querySelector('#clientsTable tbody');
                tbody.innerHTML = '';

                filteredClients.forEach(client => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>#${client.id.slice(0, 8)}</td>
                        <td>${client.name}</td>
                        <td>${client.phone}</td>
                        <td>${client.email || '-'}</td>
                        <td>${client.address || '-'}</td>
                        <td><span class="status-badge status-activo">Activo</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-info btn-custom" onclick="window.viewClient('${client.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-warning btn-custom" onclick="window.editClient('${client.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-custom" onclick="window.deleteClient('${client.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="btn btn-primary btn-custom" onclick="window.createClientReminder('${client.id}', '${client.name}')">
                                    <i class="fas fa-bell"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error al buscar clientes:', error);
                showNotification('Error al buscar clientes: ' + error.message, 'error');
            }
        };

        // Función para mostrar notificaciones
        function showNotification(message, type = 'info') {
            const notificationDiv = document.createElement('div');
            notificationDiv.className = `alert alert-${type} alert-dismissible fade show notification-toast`;
            notificationDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notificationDiv);
            
            setTimeout(() => {
                notificationDiv.remove();
            }, 5000);
        }

        // Inicialización cuando el DOM está cargado
        document.addEventListener('DOMContentLoaded', () => {
            setActiveNavItem();
            loadClients();
            loadThemePreference();
        });

        // Exportar funciones al objeto window para uso global
        Object.assign(window, {
            addNewClient,
            saveNewClient,
            viewClient,
            editClient,
            saveEditedClient,
            deleteClient,
            searchClients,
            createClientReminder
        });
    </script>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
